services:
  - docker
cache:
  directories:
    - build/
    - build_docs/


before_install:
  - docker run --rm --privileged multiarch/qemu-user-static:register --reset


addons:
  apt:
    packages:
      - docker-ce
      - parallel
env:
  - PORTION_COUNT=10
  
 
jobs:
  include:
    - stage: prepare cache
      script:
        - make docker
        - make mathematica-self-tests
        - make download-docs
    - stage: generate tests
      script: PORTION_INDEX=1 make generate-compat-tests
    - script: PORTION_INDEX=2 make generate-compat-tests
    - script: PORTION_INDEX=3 make generate-compat-tests
    - script: PORTION_INDEX=4 make generate-compat-tests
    - script: PORTION_INDEX=5 make generate-compat-tests
    - script: PORTION_INDEX=6 make generate-compat-tests
    - script: PORTION_INDEX=7 make generate-compat-tests
    - script: PORTION_INDEX=8 make generate-compat-tests
    - script: PORTION_INDEX=9 make generate-compat-tests
    - script: PORTION_INDEX=10 make generate-compat-tests
    - stage: deploy
      script: skip
      deploy: &pages
        provider: pages
        skip-cleanup: true
        github-token: $GITHUB_TOKEN  # Set in the settings page of your repository, as a secure variable
        keep-history: true
        on:
          branch: master
        local-dir: output/



