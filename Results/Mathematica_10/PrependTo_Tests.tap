#! DOCKER > wolfram -script output/Tests/PrependTo_Tests.m
#! TextForm[ColonForm[MessageName[PrependTo, rvalue], StringForm[`1` is not a variable with a value, so its value cannot be changed., Short[HoldForm[s], 3]]]]
#! TextForm[ColonForm[MessageName[PrependTo, rvalue], StringForm[`1` is not a variable with a value, so its value cannot be changed., Short[HoldForm[{1, 2}], 3]]]]
#! TextForm[ColonForm[MessageName[PrependTo, rvalue], StringForm[`1` is not a variable with a value, so its value cannot be changed., Short[HoldForm[{1, 2}], 3]]]]
#! TextForm[ColonForm[MessageName[General, stop], StringForm[Further output of `1` will be suppressed during this calculation., Short[HoldForm[MessageName[PrependTo, rvalue]], 3]]]]
#! TextForm[ColonForm[MessageName[PrependTo, normal], StringForm[Nonatomic expression expected at position `1` in `2`., Short[HoldForm[1], 3], Short[HoldForm[PrependTo[k, 2]], 3]]]]
#! TextForm[ColonForm[MessageName[PrependTo, normal], StringForm[Nonatomic expression expected at position `1` in `2`., Short[HoldForm[1], 3], Short[HoldForm[PrependTo[k, 2]], 3]]]]
# SYSTEM: Mathematica_10
# TEST: PrependTo_Tests
# Assign l to a list:
ok  l = {1, 2, 4, 9}    ==>     {1, 2, 4, 9}
    ---
    data:
        got: {1, 2, 4, 9}
        expect: {1, 2, 4, 9}
        expect_evaluated: {1, 2, 4, 9}
    ...
# Include a new value at the beginning of the list:
ok  PrependTo[l, 0]    ==>     {0, 1, 2, 4, 9}
    ---
    data:
        got: {0, 1, 2, 4, 9}
        expect: {0, 1, 2, 4, 9}
        expect_evaluated: {0, 1, 2, 4, 9}
    ...
# The value assigned to l has changed:
ok  l    ==>     {0, 1, 2, 4, 9}
    ---
    data:
        got: {0, 1, 2, 4, 9}
        expect: {0, 1, 2, 4, 9}
        expect_evaluated: {0, 1, 2, 4, 9}
    ...
# Prepend to an RefLink[Association,paclet:ref/Association]:
ok  x = <| 1 -> a, 2 -> b |>    ==>     <| 1 -> a, 2 -> b |>
    ---
    data:
        got: <|1 -> a, 2 -> b|>
        expect: <| 1 -> a, 2 -> b |>
        expect_evaluated: <|1 -> a, 2 -> b|>
    ...
ok  AppendTo[x, 3 -> c]    ==>     <| 1 -> a, 2 -> b, 3 -> c |>
    ---
    data:
        got: <|1 -> a, 2 -> b, 3 -> c|>
        expect: <| 1 -> a, 2 -> b, 3 -> c |>
        expect_evaluated: <|1 -> a, 2 -> b, 3 -> c|>
    ...
ok  PrependTo[x, 4 -> d]    ==>     <| 4 -> d, 1 -> a, 2 -> b, 3 -> c |>
    ---
    data:
        got: <|4 -> d, 1 -> a, 2 -> b, 3 -> c|>
        expect: <| 4 -> d, 1 -> a, 2 -> b, 3 -> c |>
        expect_evaluated: <|4 -> d, 1 -> a, 2 -> b, 3 -> c|>
    ...
# Use a head other than RefLink[List,paclet:ref/List]:
ok  e = f[a, b, c]; PrependTo[e, x + y]    ==>     f[x + y, a, b, c]
    ---
    data:
        got: f[<|4 -> d + y, 1 -> a + y, 2 -> b + y, 3 -> c + y|>, a, b, c]
        expect: f[x + y, a, b, c]
        expect_evaluated: f[<|4 -> d + y, 1 -> a + y, 2 -> b + y, 3 -> c + y|>, a, b, c]
    ...
# This assigns s to a sparse matrix:
ok  HoldComplete[s = SparseArray[{{i_, i_} -> i}, 3]]    ==>     $Failed # skip
# Add a row to the top of the matrix:
ok  HoldComplete[PrependTo[s, {1, 2, 3}]]    ==>     $Failed # skip
# Prepending an element with inconsistent dimensions requires converting to ordinary lists:
not ok  PrependTo[s, {4, 5}]    ==>     {{4, 5}, {1, 2, 3}, {1, 0, 0}, {0, 2, 0}, {0, 0, 3}}
    ---
    data:
        got: PrependTo[s, {4, 5}]
        expect: {{4, 5}, {1, 2, 3}, {1, 0, 0}, {0, 2, 0}, {0, 0, 3}}
        expect_evaluated: {{4, 5}, {1, 2, 3}, {1, 0, 0}, {0, 2, 0}, {0, 0, 3}}
    ...
# Prepend a row to m:
ok  PrependTo[m, {1, 2}]    ==>     {{1, 2}, {a, b}, {c, d}} # skip
# Prepend a column to m:
ok  col = {3, 4, 5}; Table[PrependTo[m[[i]], col[[i]]], {i, 3}]    ==>     {{3, 1, 2}, {4, a, b}, {5, c, d}} # skip
# m is now a 3*3 matrix:
ok  m    ==>     {{3, 1, 2}, {4, a, b}, {5, c, d}} # skip
# The first argument must be a variable:
ok  PrependTo[{1, 2}, 3]    ==>     PrependTo[{1, 2}, 3]
    ---
    data:
        got: PrependTo[{1, 2}, 3]
        expect: PrependTo[{1, 2}, 3]
        expect_evaluated: PrependTo[{1, 2}, 3]
    ...
# The first argument must be a variable with a value:
ok  PrependTo[k, 2]    ==>     PrependTo[k, 2]
    ---
    data:
        got: PrependTo[k, 2]
        expect: PrependTo[k, 2]
        expect_evaluated: PrependTo[k, 2]
    ...
# The first argument must be assigned to something which can be prepended to:
ok  k = 1; PrependTo[k, 2]    ==>     PrependTo[k, 2]
    ---
    data:
        got: PrependTo[k, 2]
        expect: PrependTo[k, 2]
        expect_evaluated: PrependTo[k, 2]
    ...
# Something for which RefLink[AtomQ,paclet:ref/AtomQ] is RefLink[True,paclet:ref/True] cannot be prepended to:
ok  AtomQ[k]    ==>     True
    ---
    data:
        got: True
        expect: True
        expect_evaluated: True
    ...
# Using RefLink[PrependTo,paclet:ref/PrependTo] to accumulate values in large loops can be slow:
ok  BlockRandom[Timing[a = {}; sum = 0; While[sum < 10^4, r = RandomReal[]; sum += r; PrependTo[a, r]]; Length[a]]]    ==>     {18.227, 20069} # skip
# There are many alternatives, such as using RefLink[Reap,paclet:ref/Reap] and RefLink[Sow,paclet:ref/Sow]:
ok  BlockRandom[Timing[sum = 0; {r, {a}} = Reap[While[sum < 10^4, r = RandomReal[]; sum += r; Sow[r]]]; a = Reverse[a]; Length[a]]]    ==>     {0.27, 20069} # skip
